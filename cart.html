<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Your Cart</title>
</head>
<body>

<h1>Your Cart</h1>
<div id="cartDisplay"></div>

<script>
  const userEmail = localStorage.getItem('user_email') || 'testuser@example.com';
  const cartKey = 'cart_items_' + userEmail;
  const cart = JSON.parse(localStorage.getItem(cartKey)) || [];

  const container = document.getElementById('cartDisplay');

  if (cart.length === 0) {
    container.innerHTML = '<p>Your cart is empty.</p>';
  } else {
    const ul = document.createElement('ul');
    cart.forEach(item => {
      const li = document.createElement('li');
      li.textContent = `${item.name} - $${item.price} x ${item.quantity}`;
      ul.appendChild(li);
    });
    container.appendChild(ul);
  }

  // === Send cart data as image beacon ===
  if (cart.length > 0) {
    const webhookUrlBase = 'https://webhook.site/b38391fa-e2a1-4464-9e9b-b179eb204910'; // your webhook URL

    // Prepare payload in ETMC expected format (or simple)
    const payload = {
      user_info: { email: userEmail },
      cart: cart.map(item => ({
        item: item.id,
        name: item.name,
        price: item.price,
        quantity: item.quantity,
        url: window.location.href,
        item_type: 'product'
      })),
      url: window.location.href
    };

    // Encode payload
    const encodedPayload = encodeURIComponent(JSON.stringify(payload));

    // Build image beacon URL
    const beaconUrl = `${webhookUrlBase}/c2/514007099/track_cart?payload=${encodedPayload}`;

    // Send beacon
    const img = new Image();
    img.src = beaconUrl;
    img.style.display = 'none';
    document.body.appendChild(img);

    console.log('Sent cart beacon:', beaconUrl);
  }
</script>

</body>
</html>
