<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Your Cart</title>
</head>
<body>
  <h1>Your Cart</h1>
  <div id="cartDisplay"></div>

  <script>
    // Get current user's email and cart
    const userEmail = localStorage.getItem("user_email");
    const cartKey = `cart_items_${userEmail}`;
    const cart = JSON.parse(localStorage.getItem(cartKey)) || [];

    const container = document.getElementById("cartDisplay");

    // Display cart items
    if (cart.length === 0) {
      container.innerHTML = "<p>Your cart is empty.</p>";
    } else {
      const ul = document.createElement("ul");
      cart.forEach(item => {
        const li = document.createElement("li");
        li.textContent = `${item.name} - $${item.price} x ${item.quantity}`;
        ul.appendChild(li);
      });
      container.appendChild(ul);
    }

    // === Einstein/ETMC style tracking using image beacon to avoid CORS ===
    // Replace with your actual org ID and webhook site URL
    const webhookBase = "webhook.site/b38391fa-e2a1-4464-9e9b-b179eb204910"; // <-- Your webhook.site URL without protocol
    const orgId = "514007099"; // Your org ID

    if (cart.length > 0 && userEmail) {
      const payloadObj = {
        user_info: { email: userEmail },
        cart: cart,
        url: window.location.href
      };
      const payloadStr = encodeURIComponent(JSON.stringify(payloadObj));
      const img = new Image();
      img.src = `https://${webhookBase}/c2/${orgId}/track_cart?payload=${payloadStr}`;
      img.style.display = "none";
      img.width = 0;
      img.height = 0;
      img.alt = "";
      img.setAttribute("aria-hidden", "true");
      document.body.appendChild(img);

      console.log("Tracking image beacon sent with payload:", payloadObj);
    }
  </script>
</body>
</html>
