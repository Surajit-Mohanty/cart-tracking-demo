<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Your Cart</title>
</head>
<body>
  <h1>Your Cart</h1>
  <div id="cartDisplay"></div>

  <script>
    // Get current user's email and cart
    const userEmail = localStorage.getItem("user_email");
    const cartKey = `cart_items_${userEmail}`;
    const cart = JSON.parse(localStorage.getItem(cartKey)) || [];

    const container = document.getElementById("cartDisplay");

    // Display cart
    if (cart.length === 0) {
      container.innerHTML = "<p>Your cart is empty.</p>";
    } else {
      const ul = document.createElement("ul");
      cart.forEach(item => {
        const li = document.createElement("li");
        li.textContent = `${item.name} - $${item.price} x ${item.quantity}`;
        ul.appendChild(li);
      });
      container.appendChild(ul);
    }

    // === Einstein/ETMC Cart Tracking via Image Beacon ===

    if (cart.length > 0 && userEmail) {
      // Prepare payload
      const payload = {
        email: userEmail,
        cart: cart
      };

      // Encode payload for URL
      const encodedPayload = encodeURIComponent(JSON.stringify(payload));

      // Your webhook site URL (replace with your own)
      const webhookBase = "https://webhook.site/b38391fa-e2a1-4464-9e9b-b179eb204910";

      // Construct full URL with payload as query param
      const url = `${webhookBase}?payload=${encodedPayload}`;

      // Create invisible image to send the data
      const img = new Image();
      img.src = url;
      img.style.display = "none";

      // Append image to body to trigger the request
      document.body.appendChild(img);

      // For debugging, you can log this
      console.log("Tracking image beacon sent with payload:", payload);
    }
  </script>
</body>
</html>
